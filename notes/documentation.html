<!DOCTYPE html>
<html>
<head>
<title>documentation.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="tillsnyggad-dokumentation">Tillsnyggad dokumentation</h1>
<blockquote>
<p><em>senast uppdaterad: 2022-12-13</em></p>
</blockquote>
<blockquote>
<p><span style = "color:red"><strong>OBS OBS OBS: Många av kod-delarna i detta dokument är inte kollad gällande slarvfel! Gäller speciellt taggar etc som står i löpande text. Rättar sånt efer hand</strong></span></p>
</blockquote>
<hr>
<br>
<h2 id="stoyrns-javascript">Stoyrns Javascript</h2>
<p>Stuff som ska stå i Storyns Javascript-ruta (i twine-editorn alltså). Förhoppningsvis kommer jag ihåg att uppdatera detta allt eftersom.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">var</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>);
script.src = <span class="hljs-string">"apsing.js"</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupGlobals</span>(<span class="hljs-params"></span>)
</span>{  
  	<span class="hljs-keyword">var</span> _state = <span class="hljs-built_in">require</span>(<span class="hljs-string">'state'</span>);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'require state'</span>);
	<span class="hljs-built_in">console</span>.log(_state.variables);
	<span class="hljs-built_in">window</span>.statevar = _state.variables;
}

setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Delayed statevarupdate for 1 second."</span>);
  setupGlobals();
}, <span class="hljs-number">1000</span>)

setupGlobals();
<span class="hljs-built_in">document</span>.head.appendChild(script)
</div></code></pre>
<p><strong>OBS</strong> Det går bra att radera alla rader med console.log! De står kvar just nu i debugg-syfte.</p>
<hr>
<br>
<h2 id="inventory">Inventory</h2>
<p><strong>Visa inventory</strong><br>
Stoppa in <code>&lt;write-inventory&gt;</code> Header eller footer.<br>
Sätt classen till: &quot;topLeft&quot; för att få lodrät inventory.<br>
Sätt ID till &quot;mainInventory&quot; för att uppdateringsfunktionen ska veta vilket element som är inventory.</p>
<p>Exempel i footer:</p>
<pre class="hljs"><code><div>&lt;inventory class=&quot;topLeft&quot;&gt;
&lt;write-inventory id=&quot;mainInventory&quot;&gt;&lt;/write-inventory&gt;
&lt;/inventory&gt;
</div></code></pre>
<p><strong>Uppdatera inventory</strong><br>
På platser där inventoryn behöver uppdateras, använd <code>&lt;update-inventory&gt;</code><br>
Detta kan göras direkt i twine-texten eller via <code>(print:&quot;&lt;update-inventory&gt;&quot;)</code><br>
<strong>Notera:</strong> Sätt variabeln före taggen med uppdatera. Annars uppdaterar den med gamla värdet.
Exempel:</p>
<pre class="hljs"><code><div>(link: &quot;ta affisch&quot;)[(set: $affisch to 1)(print: &quot;&lt;update-inventory&gt;&quot;)]

(link: &quot;ta nyckelknippa&quot;)[(set: $nyckelknippa to 1)&lt;update-inventory&gt;]

(link: &quot;ficklampa&quot;)[(set: $ficklampa to 1)(print: &quot;&lt;write-inventory type='update'&gt;&quot;)]

</div></code></pre>
<p>Samtliga dessa 3 alternativ fungerar i nuläget.  Säkrast är att använda alternativet längst upp med print och update-inventory taggen.</p>
<p><strong>Under huven</strong><br>
Jag hade vissa problem med detta eftersom state-variabeln inte uppdaterades omedelbart. Därför uppdaterade den med gamla värde någon millisekund före den fick nya. Det är just nu (13-dec-2022) löst med en timeout på 200 ms i update-funktionen.<br>
Om man använder (print:) macron uppstår ej detta problem eftersom den då kör klart &quot;set&quot; macron före den kör &quot;print&quot; macron.<br>
Men samtliga metoder fungerar alltså för tillfället.</p>
<p><strong>Mer under huven</strong><br>
Inventoryn har en egen array (inventoryItemsList) i JS med namn, icon och värde. Den uppdateras från Harlowe-storyns _state-variabel.</p>
<ul>
<li>Varje gång <code>&lt;update-inventory&gt;</code> körs går scriptet igenom window.statevar, hittar entrys som motsvarar alla namn i listan och sätter värdet till vad den har i window.statevar (som alltså motsvarar harlows _state).</li>
<li>Varje gång <code>&lt;write-inventory&gt;</code> körs går scriptet igenom listan och skapar HTML för att visa, eller inte visa, ikoner beroende på om de har värde 0 eller 1.  Om write-inventory anropas via update hittar den elementet med id mainInventory. I annat fall använder den sitt eget element för att veta vilken HTML den ska ersätta på sidan.</li>
</ul>
<blockquote>
<p><em>En snyggare lösning</em> hade varit att, istället för skriva ut HTML igen bara ändra klasser på befintliga element. Gick dock inte eftersom det är svårt att få kontroll över vad Twine-motorn skriver ut här och där.
<br>
<br></p>
</blockquote>
<hr>
<br>
<h2 id="m%C3%A4tarna-score-bars">Mätarna, score-bars</h2>
<p>Sätt in mätarna i headern.</p>
<ul>
<li>Omge det hela med en <code>&lt;span id=&quot;updatearea&quot;&gt;</code> för att uppdatera-funktionen ska hitta elementet.</li>
<li>Använd taggen <code>&lt;score-bar type=&quot;a&quot;&gt;</code> eller type=b. a= hypnos. b= död. Där scorebar ska ligga.</li>
<li>Taggen <code>&lt;score-bar type=&quot;update&quot;&gt;</code> där uppdatering ska ske. Gärna med en (print:) macro.</li>
<li>Taggen <code>&lt;huvud&gt;...&lt;/huvud&gt;</code> runt alltihop för att flytta och låsa scorebar längst upp på sidan. Om man vill det.</li>
</ul>
<p>Exempel: i header:</p>
<pre class="hljs"><code><div>&lt;huvud&gt;\
&lt;span  id=&quot;updatearea&quot;&gt;\
&lt;score-bar type=&quot;a&quot;&gt;$hypnos&lt;/score-bar&gt;&lt;score-bar type=&quot;b&quot;&gt;$död&lt;/score-bar&gt;\
&lt;/span&gt;\
&lt;/huvud&gt;\
</div></code></pre>
<p><strong>NOTERA:</strong> Backslash \ i slutet av varje rad tar bort radbryt. Använder det för att få mer överskådlig kod, allt kan skrivas på samma rad lika gärna.<br>
<strong>NOTERA 2:</strong> Tidigare fanns script-tagg som satte window.hypnos och död i headern. Dessa ska inte behövas längre. <em>(december 2022)</em><br>
<br></p>
<p><strong>Uppdatera mätarna</strong><br>
Där mätarna ska uppdateras, använd: <code>&lt;score-bar type=&quot;update&quot;&gt;</code>. Använd Print: macron för detta, så den säkert hinner uppdatera i rätt följd.
Exempel:</p>
<pre class="hljs"><code><div>(link: &quot;Titta på pendeln&quot;)[(set: $hypnos to it + 1)(print: &quot;&lt;score-bar type='update'&gt;&quot;)]

(link: &quot;Set hypnos till 4&quot;)[(set: $hypnos to 4)(print: &quot;&lt;score-bar type='update'&gt;Oj oj, du känner dig hypnotiserad!&lt;/score-bar&gt;&quot;)]

(link: &quot;Minska död&quot;)[(set: $död to it-1)(print: &quot;&lt;score-bar type='update'&gt;Ett steg närmare döden!&lt;/score-bar&gt;&quot;)]

</div></code></pre>
<p><strong>Under huven</strong><br>
Score-bar använder css-variabler som uppdateras baserat på window.statevar. Skriver ned mer här senare, om jag ids.<br>
Java-scriptet räknar om hur stor del som ska synas utifrån att maxvärdet för båda är 5.
<br></p>
<blockquote>
<p><strong>Toppen eller botten</strong><br>
Gjorde en temporär (eller permanent) CSS klass för att testa lägga scorebar på botten. Sätt class=&quot;botten&quot; i huvud-taggen så ska den hamna i botten istället. <code>&lt;huvud class=&quot;botten&quot;&gt;</code>
<br></p>
</blockquote>
<blockquote>
<p><strong>BUGG-KOLL</strong><br>
När man har låst score-bar uppe eller nere i skärm ligger den ovanpå allt. Det gör att text och länkar kan hamna under och ej gå att nå även om man scrollar. Speciellt om man lägger score-bar i botten. Jag har justerat marginaler för att undvika detta, men nåt vi får testa i olika skärmupplösningar.<br>
<br>
En annan &quot;bugg&quot; är att död-siffran ej syns när värdet är 5 (dvs start-värdet (tror jag)). Försöker se hur detta kan åtgärdas. Det har nåt att göra med att död mätaren går åt &quot;fel&quot; håll.
<br>
<br></p>
</blockquote>
<hr>
<br>
<h2 id="text-fx">Text-FX</h2>
<p>Det går nu att lägga till några text-effekter med taggen text-fx följt av typ.</p>
<ul>
<li>Taggen är <code>&lt;text-fx type=&quot;cssTypen&quot; target=&quot;ID eller element&quot;&gt;</code></li>
<li>type måste överensstämma med någon lämplig CSS klass, kan vara flera.</li>
<li>Target kan användas för att rikta effekten på innehållet mellan antingen egna element eller div/span med unikt ID.</li>
<li>Target fångar enast upp första elementet/IDt av den typen på sidan.</li>
<li>Utelämna target för att påverka texten mellan de egna text-fx taggarna.</li>
</ul>
<p><strong>Typer att använda</strong></p>
<ul>
<li>textFXfade - fade ut och in i slump ordning.</li>
<li>textFXfall - orden faller ned.</li>
<li>freeze - läggs till textFXfade för att fadea ut och stanna dolda.</li>
<li>inOrder - läggs till för att falla eller fadea i ordning, ej slump.</li>
</ul>
<p><strong>exempel:</strong></p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">text-fx</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textFXfade"</span>&gt;</span>Orden i denna text fadear in och ut i slumpmässig ordning.<span class="hljs-tag">&lt;/<span class="hljs-name">text-fx</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">text-fx</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textFXfade freeze"</span>&gt;</span>Orden i denna text fadear ut i slumpmässig ordning och förblir gömda.<span class="hljs-tag">&lt;/<span class="hljs-name">text-fx</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">text-fx</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textFXfade freeze inOrder"</span>&gt;</span>Orden i denna text fadear ut i följd och förblir gömda.<span class="hljs-tag">&lt;/<span class="hljs-name">text-fx</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">text-fx</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textFXfall inOrder"</span>&gt;</span>Orden i denna text faller i följd.<span class="hljs-tag">&lt;/<span class="hljs-name">text-fx</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">text-fx</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textFXfall"</span>&gt;</span>Orden i denna text faller i slumpmässig ordning.<span class="hljs-tag">&lt;/<span class="hljs-name">text-fx</span>&gt;</span>
</div></code></pre>
<p><strong>Exempel med target:</strong></p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"mittUnikaID"</span>&gt;</span>Denna text påverkas av text-fx taggen nedan.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
Denna text påverkas inte av någonting.
<span class="hljs-tag">&lt;<span class="hljs-name">HeltEgenTagg</span>&gt;</span> Denna text påverkas av en annan effekt nedan.<span class="hljs-tag">&lt;/<span class="hljs-name">HeltEgenTagg</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">text-fx</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textFXfade"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"mittUnikaID"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">text-fx</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textFXfall inOrder"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"HeltEgenTagg"</span>&gt;</span>

</div></code></pre>
<p><strong>Under Huven</strong><br>
Taggen skickar typ och target, saknas typ sätts den till textFX (som inte finns). Saknas Target sätts den till self.
Sciptet plockar in texten från elementet (som antingen är target eller egna elmentet).
Scriptet delar upp orden, gör lite trix med <code>&lt;br&gt;</code> taggar etc.
Orden lopas igenom och får en <code>&lt;span&gt;</code> av klassen typ. Den skickar också in css variabler för random värde och index (ordning) som kan användas i CSS klassen, se nedan.
Texten i elementet ersätts med nya varrianten där varje ord är inkapslat i ett span.
Sedan är det upp till CSS klassen vad som händer.</p>
<p><strong>För att skapa ytterligare effekter:</strong></p>
<ul>
<li>Skapa en lämplig CSS klass med lite trix.</li>
<li>Använd klassens namn som type.</li>
<li>Se aps-visualfx.css hur textFXfade och textFXfall är gjorda.</li>
</ul>
<blockquote>
<p>CSS variabler som genereras:<br>
--rnd-value - Ett slumpmässigt värde (just nu mellan 0 och 3, kan ändas senare).<br>
--index-value - vilket nummer i ordningen ordet har. börjar på 1.</p>
</blockquote>
<p><strong>exempel css klass</strong></p>
<pre class="hljs"><code><div>.testTextFx{
  opacity: var(--rnd-value);
  color: hsl(calc(10*var(--index-value)), 100%, 50%);
  display: inline-block;
}
</div></code></pre>
<p>Används så här:</p>
<pre class="hljs"><code><div>&lt;text-fx type=&quot;testTextFx&quot;&gt;Orden i denna text får statisk slumpmässig opacitet och ett färgvärde som ändras beroende på var i ordningen orset står.&lt;/text-fx&gt; &lt;br&gt;
</div></code></pre>
<blockquote>
<p><strong>ToDo</strong></p>
<ul>
<li>Lägg till möjlighet att påverka hastighet av olika slag?</li>
<li>Möjlighet att påverka totala fördröjningen innan den startar.</li>
<li>Behövs möjlighet att dela upp i bokstäver istället för hela ord?</li>
</ul>
</blockquote>
<hr>
<br>
<h2 id="ljud-och-musik">Ljud och musik</h2>
<p>Inget har förändrats i hur ljud och musik spelas. Skriver in i denna dokumentation senare.</p>
<h2 id="visual-fx">Visual FX</h2>
<p>Inget av detta har ändrats senaste tiden. Skriver in i denna dockumentation senare.</p>

</body>
</html>
